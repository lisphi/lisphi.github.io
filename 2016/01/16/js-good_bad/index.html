<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.useso.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="互联网,JavaScript,Web" />





  <link rel="alternate" href="/atom.xml" title="李少鹏的网络日志" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="JavaScript 可能是迄今为止最被误解的语言，它包含的许多美妙设计被其同样包含的糟糕设计所淹没，总体上给人的印象是一种没有做好充分设计的、稍显混乱的玩具语言。现在我们再重新梳理一下语言的基本特性，仔细分辨哪些是好的、哪些是坏的。
维基百科是这样描述 JavaScript 的：

JavaScript is a high-level, dynamic, untyped, and interpr">
<meta property="og:type" content="article">
<meta property="og:title" content="后端程序员的 JavaScript 之旅 - 好的设计与坏的设计">
<meta property="og:url" content="http://lishaopeng.com/2016/01/16/js-good_bad/index.html">
<meta property="og:site_name" content="李少鹏的网络日志">
<meta property="og:description" content="JavaScript 可能是迄今为止最被误解的语言，它包含的许多美妙设计被其同样包含的糟糕设计所淹没，总体上给人的印象是一种没有做好充分设计的、稍显混乱的玩具语言。现在我们再重新梳理一下语言的基本特性，仔细分辨哪些是好的、哪些是坏的。
维基百科是这样描述 JavaScript 的：

JavaScript is a high-level, dynamic, untyped, and interpr">
<meta property="og:image" content="http://lishaopeng.com/./images/js-good_bad-title.jpg">
<meta property="og:updated_time" content="2016-03-07T12:46:47.126Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="后端程序员的 JavaScript 之旅 - 好的设计与坏的设计">
<meta name="twitter:description" content="JavaScript 可能是迄今为止最被误解的语言，它包含的许多美妙设计被其同样包含的糟糕设计所淹没，总体上给人的印象是一种没有做好充分设计的、稍显混乱的玩具语言。现在我们再重新梳理一下语言的基本特性，仔细分辨哪些是好的、哪些是坏的。
维基百科是这样描述 JavaScript 的：

JavaScript is a high-level, dynamic, untyped, and interpr">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> 后端程序员的 JavaScript 之旅 - 好的设计与坏的设计 | 李少鹏的网络日志 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?073678c76cddabb5e3dc07b783ff0304";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">李少鹏的网络日志</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">网络改变沉默的大多数</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
      
        <li class="menu-item menu-item-search">
          <a href="#" class="st-search-show-outputs">
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'fKqe3aL4fXhgxFXssXhq','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                后端程序员的 JavaScript 之旅 - 好的设计与坏的设计
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-01-16T12:48:22+08:00" content="2016-01-16">
              2016-01-16
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/16/js-good_bad/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/16/js-good_bad/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="/./images/js-good_bad-title.jpg" alt="好的设计与坏的设计"><br>JavaScript 可能是迄今为止最被误解的语言，它包含的许多美妙设计被其同样包含的糟糕设计所淹没，总体上给人的印象是一种没有做好充分设计的、稍显混乱的玩具语言。现在我们再重新梳理一下语言的基本特性，仔细分辨哪些是好的、哪些是坏的。</p>
<p>维基百科是这样描述 JavaScript 的：</p>
<blockquote>
<p>JavaScript is a high-level, dynamic, untyped, and interpreted programming language. It has been standardized in the ECMAScript language specification. Alongside HTML and CSS, it is one of the three essential technologies of World Wide Web content production; the majority of websites employ it and it is supported by all modern web browsers without plug-ins. JavaScript is prototype-based with first-class functions, making it a multi-paradigm language, supporting object-oriented, imperative, and functional programming styles. It has an API for working with text, arrays, dates and regular expressions, but does not include any I/O, such as networking, storage or graphics facilities, relying for these upon the host environment in which it is embedded.</p>
</blockquote>
<p>可以清楚地看到， JavaScript 是高级的、动态的、弱类型的、解释型的语言。同时又指出它是基于原型的、以函数作为一等公民的，同时支持面向对象的、命令式的、具有函数式编程风格的多范式语言。是不是比第一印象中的强大很多？事实上，在支持多编程范式这一点上，跟 Java 、 C# 等语言相比是赢在起跑线上的。<br><a id="more"></a></p>
<h2 id="u597D_u7684_u8BBE_u8BA1"><a href="#u597D_u7684_u8BBE_u8BA1" class="headerlink" title="好的设计"></a>好的设计</h2><h3 id="u662F_u5BF9_u8C61_u8FD8_u662F_u51FD_u6570_uFF1F"><a href="#u662F_u5BF9_u8C61_u8FD8_u662F_u51FD_u6570_uFF1F" class="headerlink" title="是对象还是函数？"></a>是对象还是函数？</h3><p>Object 是类，是对象，还是函数？以一个 Java 、 C# 的程序员的视角， Object 更象一个类，在 JavaScript 中我们可以使用 new 操作符将 Object 创建出一个对象。但是很显然 Object 不是类， JavaScript 中并不存在类的概念， new 之所以能创建出对象，是因为把 Object 当做构造函数，用于对象的初始化。通过 <code>typeof Object</code> 操作可以知道 Object 是一个函数。再通过另外一个更科学的技巧，使用 <code>Object.prototype.toString.apply(Object)</code> 可以得到 <code>&quot;[object Function]&quot;</code>。下列的第一个表格列出了一些典型的考察目标，可以得出结论： Object 首先是个对象，其次它也是一个函数，或者我们可以称之为函数对象。</p>
<p>函数对象可以：</p>
<ul>
<li>被直接调用</li>
<li>绑定到某个对象调用</li>
<li>如果仅仅只有初始化对象的功能可以施加 new 构造出一个对象</li>
<li>象普通的对象一样操作它的属性<br>比如这样操作也是合法的。 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.foo = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.foo); <span class="comment">// 打印出 1</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>顺带说一句，typeof 操作符是个坏设计，无法分区对象的具体类型，可以对照见下列的第二个表格中的具体示例。我们可以借助 Object.prototype.toString 或第三方库的替代方案得到真正想要的结果。</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">Object</th>
<th style="text-align:center">Function</th>
<th style="text-align:center">Date</th>
<th style="text-align:center">Array</th>
<th style="text-align:center">Foo</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">typeof ???</td>
<td style="text-align:center">“function”</td>
<td style="text-align:center">“function”</td>
<td style="text-align:center">“function”</td>
<td style="text-align:center">“function”</td>
<td style="text-align:center">“function”</td>
</tr>
<tr>
<td style="text-align:center">toString.apply(???)</td>
<td style="text-align:center">“[object Function]”</td>
<td style="text-align:center">“[object Function]”</td>
<td style="text-align:center">“[object Function]”</td>
<td style="text-align:center">“[object Function]”</td>
<td style="text-align:center">“[object Function]”</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">{}</th>
<th style="text-align:center">[]</th>
<th style="text-align:center">Math</th>
<th style="text-align:center">JSON</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">typeof ???</td>
<td style="text-align:center">“object”</td>
<td style="text-align:center">“object”</td>
<td style="text-align:center">“object”</td>
<td style="text-align:center">“object”</td>
</tr>
<tr>
<td style="text-align:center">toString.apply(???)</td>
<td style="text-align:center">“[object Object]”</td>
<td style="text-align:center">“[object Array]”</td>
<td style="text-align:center">“[object Math]”</td>
<td style="text-align:center">“[object JSON]”</td>
</tr>
</tbody>
</table>
<p>注：<br>  var toString = Object.prototype.toString<br>  var Foo = function() {}</p>
<h3 id="u57FA_u4E8E_u539F_u578B_u7684_u9762_u5411_u5BF9_u8C61"><a href="#u57FA_u4E8E_u539F_u578B_u7684_u9762_u5411_u5BF9_u8C61" class="headerlink" title="基于原型的面向对象"></a>基于原型的面向对象</h3><p>JavaScript 是支持面向对象编程范式的语言，跟基于类的面向对象语言（如 C++ 、 Java 、 C# 等语言）不同，Javascript 是基于原型的面向对象设计。出于某种妥协，从语法上构建一个对象跟传统的基于类的面向对象语言类似，都是通过 new 操作符创建，但是工作方式存在巨大的差别。这种使用 new 操作符创建对象的方式由于隐藏了基于原型的面向对象机制，方便传统程序员的习惯，也容易引起初学者混淆，是存在争议的。<br>JavaScript 对象拥有一个不对外公开的 <code>__proto__</code> 属性引用到对象的原型，获取对象属性值的过程为：</p>
<ol>
<li>首先获取对象自身属性的值</li>
<li>如果对象本身的属性不存在，者获取对象原型引用的属性值</li>
<li>依次类推，直到原型引用为空</li>
</ol>
<p>下面的代码片段是 JavaScript 使用传统风格的面向对象示例。 Person 为构造函数，通过 new 操作符调用，返回初始化的对象； Person.prototype 定义原型，所有构造函数创建出来的对象，其 <code>__proto__</code> 引用到 Person.prototype。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName, age, gender</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">    <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.gender = gender;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.nationality = <span class="string">'China'</span>;</span><br><span class="line"></span><br><span class="line">Person.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.firstName + <span class="string">' '</span> + <span class="keyword">this</span>.lastName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.getAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.getGender = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.gender;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params">firstName, lastName, age, gender, title</span>) </span>&#123;</span><br><span class="line">    Person.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">this</span>.title = title;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Employee.prototype = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line">Employee.prototype.constructor = Employee;</span><br><span class="line"></span><br><span class="line">Employee.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Person.prototype.getName.apply(<span class="keyword">this</span>) + <span class="string">', '</span> + <span class="keyword">this</span>.title;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> classicalPerson = <span class="keyword">new</span> Person(<span class="string">'San'</span>, <span class="string">'Su'</span>, <span class="number">10</span>, <span class="string">'female'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(classicalPerson.getName()); <span class="comment">// San Su</span></span><br><span class="line"><span class="keyword">var</span> classicalEmployee = <span class="keyword">new</span> Employee(<span class="string">'San'</span>, <span class="string">'Su'</span>, <span class="number">10</span>, <span class="string">'female'</span>, <span class="string">'Manager'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(classicalEmployee.getName()); <span class="comment">// San Su, Manager</span></span><br></pre></td></tr></table></figure></p>
<p>再比较一下基于原型的面向对象的实现，跟上一个代码片段的功能是等价的，可以看到这种原生的实现方式简洁且同样富有表现力。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> personPrototype = &#123;</span><br><span class="line">    nationality: <span class="string">'China'</span>, </span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.firstName + <span class="string">' '</span> + <span class="keyword">this</span>.lastName; </span><br><span class="line">    &#125;,</span><br><span class="line">    getAge: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;,</span><br><span class="line">    getGender: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.gender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> prototypalPerson = <span class="built_in">Object</span>.create(personPrototype);</span><br><span class="line"></span><br><span class="line">prototypalPerson.firstName = <span class="string">'San'</span>;</span><br><span class="line">prototypalPerson.lastName = <span class="string">'Su'</span>;</span><br><span class="line">prototypalPerson.age = <span class="number">10</span>;</span><br><span class="line">prototypalPerson.gender = <span class="string">'female'</span>;</span><br><span class="line"></span><br><span class="line">prototypalPerson.getName(); <span class="comment">// San Su</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> employeePrototype = <span class="built_in">Object</span>.create(personPrototype);</span><br><span class="line">employeePrototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> personPrototype.getName.apply(<span class="keyword">this</span>) + <span class="string">', '</span> + <span class="keyword">this</span>.title;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">employeePrototype.firstName = <span class="string">'San'</span>;</span><br><span class="line">employeePrototype.lastName = <span class="string">'Su'</span>;</span><br><span class="line">employeePrototype.age = <span class="number">10</span>;</span><br><span class="line">employeePrototype.gender = <span class="string">'female'</span>;</span><br><span class="line">employeePrototype.title = <span class="string">'Manager'</span>;</span><br><span class="line"></span><br><span class="line">employeePrototype.getName();  <span class="comment">// San Su, Manager</span></span><br></pre></td></tr></table></figure></p>
<h3 id="u51FD_u6570_u5F0F_u7279_u6027"><a href="#u51FD_u6570_u5F0F_u7279_u6027" class="headerlink" title="函数式特性"></a>函数式特性</h3><p>JavaScript 是以函数作为一等公民的语言，支持 lambda 表达式，高阶函数，柯里化等函数式特性。下面的代码片段是柯里化的实现示例，将 add 函数施加柯里化函数编程变成一个新的函数。 顺便说明一下，示例代码中使用了 arguments 对象，这个对象是一种类数组的对象，通过 <code>Object.prototype.apply(arguments)</code> 可以得验证，其结果是 <code>&quot;[object Object]&quot;</code>，需要通过 <code>Array.prototype.slice</code> 函数转换成 Array ， arguments 对象是一种坏的设计，需要加以注意。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> slice = <span class="built_in">Array</span>.prototype.slice;</span><br><span class="line">    args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fn.apply(<span class="literal">null</span>, args.concat(slice.apply(<span class="built_in">arguments</span>)));</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> plusOne = curry(add, <span class="number">1</span>);</span><br><span class="line">plusOne(<span class="number">3</span>); <span class="comment">// 4;</span></span><br><span class="line">curry(add, <span class="number">2</span>)(<span class="number">3</span>); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure></p>
<h2 id="u574F_u7684_u8BBE_u8BA1"><a href="#u574F_u7684_u8BBE_u8BA1" class="headerlink" title="坏的设计"></a>坏的设计</h2><h3 id="u5168_u5C40_u53D8_u91CF"><a href="#u5168_u5C40_u53D8_u91CF" class="headerlink" title="全局变量"></a>全局变量</h3><p>全局变量可以说是 JavaScript 语言的万恶之源，有三种方式可以定义全局变量：</p>
<ol>
<li><p>在任何函数之外定义</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = value;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过全局对象的属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.foo = value; <span class="comment">// 在node.js中为 global.foo = value;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>直接使用没有申明的变量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo = value; <span class="comment">// 在node.js中为 global.foo = value;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>第三种定义方式是罪魁祸首，一不小心就会定义或使用全局变量，引起难以排查的Bug。</p>
<h3 id="u4F5C_u7528_u57DF"><a href="#u4F5C_u7528_u57DF" class="headerlink" title="作用域"></a>作用域</h3><p>JavaScript 使用了类似 C 语言的使用花括号的代码块设计，但是跟 C 语言不同的是代码块并不会隔离出一个单独的作用域，JavaScript 是以函数为单位创建作用域的。这种松散的作用域设计与全局变量的设计遥相呼应，成为一对奇葩组合，祸害了一批又一批无辜的前端码农。 </p>
<h3 id="u81EA_u52A8_u63D2_u5165_u5206_u53F7"><a href="#u81EA_u52A8_u63D2_u5165_u5206_u53F7" class="headerlink" title="自动插入分号"></a>自动插入分号</h3><p>JavaScript 解释器检测到代码行的最后如果缺少分号会企图自动补一个分号进行修正。这种设计会带来另外一个后果，先看下代码示例。getFoo 被调用之后会得到正确的对象，getFoo_undefined 被调用之后会得到 undefined 。所以，JavaScript 程序员对左花括号是否需要另起一行的终极问题上是没有争议的，我们要顺势而为。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFoo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        foo: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFoo_undefined</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">    &#123;</span><br><span class="line">        foo: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="undeclared__u3001_undefined__u4E0E_null"><a href="#undeclared__u3001_undefined__u4E0E_null" class="headerlink" title="undeclared 、 undefined 与 null"></a>undeclared 、 undefined 与 null</h3><p>下面的表格列举了 undeclared variable 、undefined variable 和 null varialble  的区别。 值得注意的是 null 是一种特殊的对象。</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">undeclared</th>
<th style="text-align:center">undefined</th>
<th style="text-align:center">null</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>描述</strong></td>
<td style="text-align:center">未申明的变量</td>
<td style="text-align:center">已申明未赋值的变量</td>
<td style="text-align:center">已申明赋空值的变量</td>
</tr>
<tr>
<td style="text-align:center"><strong>typeof ???</strong></td>
<td style="text-align:center">“undefined”</td>
<td style="text-align:center">“undefined”</td>
<td style="text-align:center">“object”</td>
</tr>
</tbody>
</table>
<p>注：<br>  var toString = Object.prototype.toString</p>
<h3 id="Number_u7C7B_u578B"><a href="#Number_u7C7B_u578B" class="headerlink" title="Number类型"></a>Number类型</h3><p>虽然我们在很多时候可以肆无忌惮地写出 <code>if (foo === 1) { /* do something */ }</code> 这样的代码通常是没有问题的，但是我们还是需要做到心里有数，JavaScript 中的 Number 是浮点型，不存在整形甚至不是 decimal 类型。再看段代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = (<span class="number">0.2</span> - <span class="number">0.1</span>) * <span class="number">10</span> === <span class="number">1</span>; <span class="comment">// foo equals true</span></span><br><span class="line"><span class="keyword">var</span> bar = (<span class="number">0.3</span> - <span class="number">0.2</span>) * <span class="number">10</span> === <span class="number">1</span>; <span class="comment">// bar equals false</span></span><br></pre></td></tr></table></figure></p>
<h2 id="u7ED3_u675F_u8BED"><a href="#u7ED3_u675F_u8BED" class="headerlink" title="结束语"></a>结束语</h2><p>可能有些同学看出来了，这篇文章根本就是 <a href="http://book.douban.com/subject/2994925/" target="_blank" rel="external">JavaScript: The Good Parts</a> 的学习笔记啊。这本书确实是 JavaScript 领域必备图书之一，在 2008 年出版，是基于 EcmaScript 3 的标准。可以看到 EcmaScript 5 / EcmaScript 6 针对这本书上列举的痛点基本都做了改进，甚至是飞跃。了解 EcmaScript 3 的基本知识，对理解 JavaScript 语言和生态圈的演化有非常大的帮助。</p>
<p>原文：<a href="http://lishaopeng.com/2016/01/16/js-good_bad/">后端程序员的 JavaScript 之旅 - 好的设计与坏的设计</a><br>简书：<a href="http://www.jianshu.com/p/0f2328fd26e4" target="_blank" rel="external">后端程序员的 JavaScript 之旅 - 好的设计与坏的设计</a></p>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JavaScript/" rel="tag">#JavaScript</a>
          
            <a href="/tags/JavaScript-之旅系列/" rel="tag">#JavaScript 之旅系列</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/01/15/js-kickoff/" rel="next" title="后端程序员的 JavaScript 之旅 - 开篇">
                <i class="fa fa-chevron-left"></i> 后端程序员的 JavaScript 之旅 - 开篇
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/01/24/js-object-system/" rel="prev" title="后端程序员的 JavaScript 之旅 - JavaScript 对象系统">
                后端程序员的 JavaScript 之旅 - JavaScript 对象系统 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/01/16/js-good_bad/"
           data-title="后端程序员的 JavaScript 之旅 - 好的设计与坏的设计" data-url="http://lishaopeng.com/2016/01/16/js-good_bad/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/benja.jpg"
               alt="李少鹏" />
          <p class="site-author-name" itemprop="name">李少鹏</p>
          <p class="site-description motion-element" itemprop="description">互联网相关技术博客</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>
          
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/lisphi" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/lisphi" target="_blank">
                  
                    <i class="fa fa-weibo"></i> 微博
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/lisphi" target="_blank">
                  
                    <i class="fa fa-globe"></i> 豆瓣
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/benjali" target="_blank">
                  
                    <i class="fa fa-globe"></i> 知乎
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/C1y1Jt" target="_blank">
                  
                    <i class="fa fa-globe"></i> 简书
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://toutiao.io/subjects/62167" target="_blank">
                  
                    <i class="fa fa-globe"></i> 头条
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#u597D_u7684_u8BBE_u8BA1"><span class="nav-number">1.</span> <span class="nav-text">好的设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#u662F_u5BF9_u8C61_u8FD8_u662F_u51FD_u6570_uFF1F"><span class="nav-number">1.1.</span> <span class="nav-text">是对象还是函数？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#u57FA_u4E8E_u539F_u578B_u7684_u9762_u5411_u5BF9_u8C61"><span class="nav-number">1.2.</span> <span class="nav-text">基于原型的面向对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#u51FD_u6570_u5F0F_u7279_u6027"><span class="nav-number">1.3.</span> <span class="nav-text">函数式特性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#u574F_u7684_u8BBE_u8BA1"><span class="nav-number">2.</span> <span class="nav-text">坏的设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#u5168_u5C40_u53D8_u91CF"><span class="nav-number">2.1.</span> <span class="nav-text">全局变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#u4F5C_u7528_u57DF"><span class="nav-number">2.2.</span> <span class="nav-text">作用域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#u81EA_u52A8_u63D2_u5165_u5206_u53F7"><span class="nav-number">2.3.</span> <span class="nav-text">自动插入分号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undeclared__u3001_undefined__u4E0E_null"><span class="nav-number">2.4.</span> <span class="nav-text">undeclared 、 undefined 与 null</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Number_u7C7B_u578B"><span class="nav-number">2.5.</span> <span class="nav-text">Number类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#u7ED3_u675F_u8BED"><span class="nav-number">3.</span> <span class="nav-text">结束语</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        

<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <!--
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  -->
  <span class="author" itemprop="copyrightHolder">李少鹏</span>
</div>

<div class="powered-by">
  pwoered by <a class="theme-link" href="http://hexo.io">Hexo</a> 
</div>

<div class="theme-info">
  theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=0.5.0"></script>



  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lishaopeng"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  

  
  


</body>
</html>
